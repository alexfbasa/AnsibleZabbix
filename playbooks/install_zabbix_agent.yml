---
- name: Install Zabbix Agent and configure host
  hosts: all
  become: yes

  tasks:
    - name: Print current user
      command: whoami
      register: current_user

    - debug:
        var: current_user.stdout

    - name: Install Zabbix Agent
      ansible.builtin.yum:
        name: zabbix-agent
        state: present

    - name: Print current working directory
      command: pwd
      register: pwd_output

    - debug:
        var: pwd_output.stdout_lines

    - name: Check if template file exists
      stat:
        path: zabbix_agent.conf.j2
      register: template_stat

    - debug:
        var: template_stat

    - name: Debug - Print Zabbix Agent config content
      command: cat zabbix_agent.conf.j2
      register: template_content

    - debug:
        var: template_content.stdout_lines

    - name: Start Zabbix Service
      ansible.builtin.service:
        name: zabbix-agent
        enabled: yes

  handlers:
    - name: restart zabbix-agent
      service:
        name: zabbix-agent
        state: restarted
